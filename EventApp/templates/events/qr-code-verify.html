{% extends 'base/base.html' %}
{% load static %}
{% block title %}QR Code Verify{% endblock %}
{% block css %}
    <link rel="stylesheet" type="text/css" href="{% static 'events/css/events.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'events/css/qrcode.css' %}">
{% endblock %}
{% block body %}
<br><br><br><br>
    <form method="post" action="" >
    {%  csrf_token %}
        <input type=text size=16 placeholder="Tracking Code" class=qrcode-text name="textqr">
        <label class=qrcode-text-btn>
            <input
            type=file accept="image/*" capture=environment onclick="return showQRIntro();"
            onchange="openQRCamera(this);" tabindex=-1 name="qr">
        </label>
        <input type="submit" value="Go">
    </form>

{% endblock %}
{% block scripts %}
    <script src="{% static 'events/js/qr_packed.js' %}"></script>
    <script>
        function openQRCamera(node) {
            var reader = new FileReader();
            reader.onload = function () {
                node.value = "";
                qrcode.callback = function (res) {
                    if (res instanceof Error) {
                        alert("No QR code found. Please make sure the QR code is within the camera's frame and try again.");
                    } else {
                        node.parentNode.previousElementSibling.value = res;
                    }
                };
                qrcode.decode(reader.result);
            };
            reader.readAsDataURL(node.files[0]);
        }

        function showQRIntro() {
            return confirm("Use your camera to take a picture of a QR code.");
        }
    </script>
    <script src="{% static 'events/js/events.js' %}"></script>
{% endblock %}

